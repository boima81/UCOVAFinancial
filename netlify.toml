# Netlify configuration file

[build]
  # Command to build your site and functions
  # This assumes you want to install dependencies from the root package.json
  # and then potentially build client and server if you have separate build steps.
  # For now, we'll keep it simple. If your server code needs a build step,
  # we might need to add it here or in its own package.json.
  command = "npm install && npm run build" # Assuming 'npm run build' builds your Vite client

  # Directory (relative to the root of your repo) that contains the deploy-ready
  # HTML files and assets generated by the build.
  publish = "dist/public"

[functions]
  # Directory (relative to the root of your repo) that contains Netlify Functions
  # (serverless lambda functions) to deploy.
  # Your esbuild command outputs the server build to 'dist',
  # so Netlify should look for the compiled function there.
  # We will treat the bundled 'dist/index.js' as a function named 'api'.
  directory = "dist" # Netlify will look for functions in this directory (e.g. dist/api.js)

[[redirects]]
  from = "/api/*"
  # This routes requests from /api/... to the 'api' function.
  # The function name 'api' corresponds to the filename 'api.js' or 'api.ts'
  # that Netlify would expect in the functions directory (which is 'dist' here).
  # Since your esbuild output is dist/index.js, we will rename it or adjust.
  # For now, let's assume we want the function to be named 'index'
  # to match the output of `esbuild server/index.ts ... --outdir=dist` which is `dist/index.js`.
  to = "/.netlify/functions/index/:splat"
  status = 200
  force = true # Ensure this rule takes precedence
